<div class="min-h-screen p-4 md:p-6 bg-[var(--bg-color)]">
  <div class="max-w-7xl mx-auto">
    <div class="mb-6">
      <h2 class="text-[18px] md:text-[22px] font-bold text-[#354044]">
        Historial de Ventas
      </h2>
      <p class="text-[12px] text-[#354044]/65 mt-1">
        Consulta ventas registradas
      </p>
    </div>

    @if (loading()) {
      <div class="bg-[#f2f1ed] rounded-2xl border border-black/10 shadow-[0_20px_50px_rgba(0,0,0,.10)] p-8 text-center">
        <div class="mx-auto mb-3 h-10 w-10 rounded-full border-4 border-black/10 border-t-[#87b26d] animate-spin"></div>
        <p class="text-[13px] text-[#354044]/75">Cargando ventas...</p>
      </div>
    }

    @if (error()) {
      <div class="bg-[#f2f1ed] rounded-2xl border border-black/10 shadow-[0_20px_50px_rgba(0,0,0,.10)] p-8 text-center">
        <div class="text-[28px] mb-2">❌</div>
        <p class="text-[13px] text-[#354044] mb-4">{{ error() }}</p>
        <button
          (click)="loadSales()"
          class="px-4 py-2 text-[12px] font-semibold rounded-xl
                 bg-[#354044] text-white
                 hover:opacity-95 transition
                 shadow-[0_14px_26px_rgba(0,0,0,.18)]"
        >
          Reintentar
        </button>
      </div>
    }

    @if (!loading() && !error() && sales().length === 0) {
      <div class="bg-[#f2f1ed] rounded-2xl border border-black/10 shadow-[0_20px_50px_rgba(0,0,0,.10)] p-8 text-center">
        <p class="text-[13px] text-[#354044]/70">No hay ventas registradas</p>
      </div>
    }

    @if (!loading() && !error() && sales().length > 0) {
      <div class="bg-[#f2f1ed] rounded-2xl border border-black/10 shadow-[0_20px_50px_rgba(0,0,0,.10)] overflow-hidden">
        <div class="px-4 py-3 bg-[var(--edit)] border-b border-black/10 flex items-center justify-between">
          <div class="text-[13px] font-semibold text-white">
            Ventas registradas
          </div>
          <div class="text-[11px] text-white">
            Página {{ currentPage() }} de {{ getTotalPages() }}
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-white/60 border-b border-black/10">
              <tr class="text-left">
                <th class="py-3 px-4 text-[11px] font-semibold text-[#354044]/80 uppercase tracking-wide">Número</th>
                <th class="py-3 px-4 text-[11px] font-semibold text-[#354044]/80 uppercase tracking-wide">Fecha</th>
                <th class="py-3 px-4 text-[11px] font-semibold text-[#354044]/80 uppercase tracking-wide">Cliente</th>
                <th class="py-3 px-4 text-[11px] font-semibold text-[#354044]/80 uppercase tracking-wide">Método</th>
                <th class="py-3 px-4 text-[11px] font-semibold text-[#354044]/80 uppercase tracking-wide text-center">Productos</th>
                <th class="py-3 px-4 text-[11px] font-semibold text-[#354044]/80 uppercase tracking-wide text-right">Total</th>
              </tr>
            </thead>

            <tbody class="divide-y divide-black/10">
              @for (sale of sales(); track sale.saleId) {
                <tr class="hover:bg-black/5 transition-colors">
                  <td class="py-3 px-4">
                    <span class="inline-flex items-center px-2 py-1 rounded-lg bg-white border border-black/10
                                 font-mono text-[12px] text-[#354044]">
                      {{ sale.saleId.substring(0, 6) }}
                    </span>
                  </td>

                  <td class="py-3 px-4">
                    <span class="text-[12px] text-[#354044]/75 whitespace-nowrap">
                      {{ formatDate(sale.createdAt) }}
                    </span>
                  </td>

                  <td class="py-3 px-4">
                    <span class="text-[12px] text-[#354044] truncate block max-w-[180px]">
                      {{ getCustomerName(sale) }}
                    </span>
                  </td>

                  <td class="py-3 px-4">
                    <span class="inline-flex items-center gap-1.5 text-[12px] text-[#354044]/80">
                      {{ getPaymentMethodLabel(sale.paymentMethod) }}
                    </span>
                  </td>

                  <td class="py-3 px-4 text-center">
                    <button
                      (click)="showTicket(sale)"
                      class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full
                             bg-[var(--edit)] text-white text-[12px] font-semibold
                             hover:opacity-95 transition
                             shadow-[0_10px_18px_rgba(0,0,0,.12)]"
                    >
                      <span class="font-bold">{{ sale.items.length }}</span>
                      <span class="font-medium">
                        producto{{ sale.items.length !== 1 ? 's' : '' }}
                      </span>
                    </button>
                  </td>

                  <td class="py-3 px-4 text-right">
                    <span class="text-[13px] font-bold text-[#354044]">
                      {{ formatCurrency(sale.total) }}
                    </span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        @if (getTotalPages() > 1) {
          <div class="border-t border-black/10 px-4 py-3 bg-white/50">
            <div class="flex items-center justify-between gap-4">
              <button
                [disabled]="currentPage() === 1"
                (click)="changePage(currentPage() - 1)"
                [class.opacity-50]="currentPage() === 1"
                [class.cursor-not-allowed]="currentPage() === 1"
                class="px-3 py-2 text-[12px] font-semibold rounded-xl
                       border border-black/10
                       bg-white text-[#354044]
                       hover:bg-black/5 transition"
              >
                ← Anterior
              </button>

              <span class="text-[12px] text-[#354044]/70">
                Página {{ currentPage() }} de {{ getTotalPages() }}
              </span>

              <button
                [disabled]="currentPage() === getTotalPages()"
                (click)="changePage(currentPage() + 1)"
                [class.opacity-50]="currentPage() === getTotalPages()"
                [class.cursor-not-allowed]="currentPage() === getTotalPages()"
                class="px-3 py-2 text-[12px] font-semibold rounded-xl
                       border border-black/10
                       bg-white text-[#354044]
                       hover:bg-black/5 transition"
              >
                Siguiente →
              </button>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <app-ticket-modal
    [sale]="selectedSale()"
    [isVisible]="showTicketModal()"
    (close)="closeTicketModal()"
  ></app-ticket-modal>
</div>
