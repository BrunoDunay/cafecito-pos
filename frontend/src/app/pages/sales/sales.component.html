<!-- components/sales/sales.component.html -->
<div class="min-h-screen bg-gray-50 p-4 md:p-6">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-8 text-center">
      <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">üìä Historial de Ventas</h2>
    </div>

    <!-- Estados -->
    @if (loading()) {
      <div class="flex flex-col items-center justify-center py-16 bg-white rounded-xl shadow-sm">
        <div class="w-12 h-12 border-4 border-gray-200 border-t-blue-500 rounded-full animate-spin mb-4"></div>
        <p class="text-gray-600 text-lg">Cargando ventas...</p>
      </div>
    }

    @if (error()) {
      <div class="bg-white rounded-xl shadow-sm p-6 text-center">
        <div class="text-red-500 text-3xl mb-3">‚ùå</div>
        <p class="text-gray-700 text-lg mb-4">{{ error() }}</p>
        <button 
          (click)="loadSales()"
          class="px-6 py-2.5 bg-blue-500 text-white font-medium rounded-lg hover:bg-blue-600 transition-colors"
        >
          Reintentar
        </button>
      </div>
    }

    @if (!loading() && !error() && sales().length === 0) {
      <div class="bg-white rounded-xl shadow-sm p-8 text-center">
        <p class="text-gray-500 text-lg">No hay ventas registradas</p>
      </div>
    }

    @if (!loading() && !error() && sales().length > 0) {
      <div class="bg-white rounded-xl shadow-sm overflow-hidden">
        <!-- Tabla -->
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white">
              <tr>
                <th class="py-3.5 px-4 text-left text-xs font-semibold uppercase tracking-wider">N√∫mero</th>
                <th class="py-3.5 px-4 text-left text-xs font-semibold uppercase tracking-wider">Fecha</th>
                <th class="py-3.5 px-4 text-left text-xs font-semibold uppercase tracking-wider">Cliente</th>
                <th class="py-3.5 px-4 text-left text-xs font-semibold uppercase tracking-wider">M√©todo</th>
                <th class="py-3.5 px-4 text-left text-xs font-semibold uppercase tracking-wider">Productos</th>
                <th class="py-3.5 px-4 text-left text-xs font-semibold uppercase tracking-wider">Total</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
              @for (sale of sales(); track sale.saleId) {
                <tr class="hover:bg-gray-50 transition-colors">
                  <!-- ID -->
                  <td class="py-3.5 px-4">
                    <strong class="font-mono text-sm text-gray-800 font-semibold">
                      {{ sale.saleId.substring(0, 6) }}
                    </strong>
                  </td>
                  
                  <!-- Fecha -->
                  <td class="py-3.5 px-4">
                    <span class="text-sm text-gray-600 whitespace-nowrap">
                      {{ formatDate(sale.createdAt) }}
                    </span>
                  </td>
                  
                  <!-- Cliente -->
                  <td class="py-3.5 px-4">
                    <span class="text-sm text-gray-700 truncate block max-w-[150px]">
                      {{ getCustomerName(sale) }}
                    </span>
                  </td>
                  
                  <!-- M√©todo -->
                  <td class="py-3.5 px-4">
                    <div class="flex items-center gap-1.5 text-sm min-w-max">
                      {{ getPaymentMethodLabel(sale.paymentMethod) }}
                    </div>
                  </td>
                  
                  <!-- Productos -->
                  <td class="py-3.5 px-4 text-center">
                    <button 
                      (click)="showTicket(sale)"
                      class="inline-flex items-center gap-1.5 px-4 py-1.5 bg-emerald-500 text-white text-sm font-medium rounded-full hover:bg-emerald-600 hover:shadow-md transition-all duration-200"
                    >
                      <span>{{ sale.items.length }}</span>
                      <span>producto{{ sale.items.length !== 1 ? 's' : '' }}</span>
                    </button>
                  </td>
                  
                  <!-- Total -->
                  <td class="py-3.5 px-4 text-right">
                    <p class="text-base font-semibold text-blue-600">
                      {{ formatCurrency(sale.total) }}
                    </p>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <!-- Paginaci√≥n -->
        @if (getTotalPages() > 1) {
          <div class="border-t border-gray-100 px-6 py-4">
            <div class="flex items-center justify-between gap-4">
              <button
                [disabled]="currentPage() === 1"
                (click)="changePage(currentPage() - 1)"
                [class.opacity-50]="currentPage() === 1"
                [class.cursor-not-allowed]="currentPage() === 1"
                class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-colors disabled:hover:bg-white disabled:hover:border-gray-300"
              >
                ‚Üê Anterior
              </button>

              <span class="text-sm text-gray-600">
                P√°gina {{ currentPage() }} de {{ getTotalPages() }}
              </span>

              <button
                [disabled]="currentPage() === getTotalPages()"
                (click)="changePage(currentPage() + 1)"
                [class.opacity-50]="currentPage() === getTotalPages()"
                [class.cursor-not-allowed]="currentPage() === getTotalPages()"
                class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-colors disabled:hover:bg-white disabled:hover:border-gray-300"
              >
                Siguiente ‚Üí
              </button>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Modal del ticket -->
  <app-ticket-modal
    [sale]="selectedSale()"
    [isVisible]="showTicketModal()"
    (close)="closeTicketModal()"
  ></app-ticket-modal>
</div>